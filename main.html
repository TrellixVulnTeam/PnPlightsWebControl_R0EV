<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Pi 'n Paper-LightControl (by derco0n)</title>
    <style>
        body {
            background: black;
            color: white;
            font-family: Arial, Helvetica, sans-serif;
        }

        input {
            background: rgb(46, 46, 46);            
            color: white;            
            font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            font-size: medium;
            
        }
        input:hover {
            background: rgb(114, 0, 0);
        }

        H1 {
            color: rgb(109, 108, 108);
            text-decoration: underline;
            font-size: larger;
        }

        H2 {
            color: rgb(59, 59, 59);
            font-style: italic;   
            font-size: medium;         
        }

        a {
            text-decoration: overline underline;
            color: rgb(59, 59, 59);            
        }    
        a:visited {
            color: rgb(97, 1, 1);
        }
        a:hover {
            color: rgb(221, 0, 0);
        }

        .block {
            display: flex;
            flex-flow: row wrap;
            align-items: center;
        }

        .smalllink {
            font-size: small; 
        }
    </style>
</head>

<body>
<H1>Pi 'n Paper - Light Control v0.11 (by <a href="https://github.com/derco0n">derco0n</a>)</H1>

<H2>Spieler:</H2>
<div id="players">
    <div id="p1" class="block">
        <div id="p1_rank">
            1: 
        </div>
        <div id="p1_name">            
            <input type="text" placeholder="Spielername" width="150" name="name_p1" id="name_p1" 
            onchange="PlayerNameChanged(name_p1)" onmouseenter="PlayerOnHover('p1')" onmouseleave="PlayerOnNoHover('p1')" />            
        </div>
        <div id="p1_points">
            <input type="number" min="0" placeholder="Punkte" width="30" name="points_p1" id="points_p1" onchange="PlayerPointsChanged(points_p1)"/>
        </div>
    </div>
    <div id="p2" class="block">
        <div id="p2_rank">
            2: 
        </div>
        <div id="p2_name">            
            <input type="text" placeholder="Spielername" width="150" name="name_p2" id="name_p2" 
            onchange="PlayerNameChanged(name_p2)" onmouseenter="PlayerOnHover('p2')" onmouseleave="PlayerOnNoHover('p2')" />            
        </div>
        <div id="p2_points">
            <input type="number" min="0" placeholder="Punkte" width="30" name="points_p2" id="points_p2" onchange="PlayerPointsChanged(points_p2)"/>
        </div>
    </div>
    <div id="p3" class="block">
        <div id="p3_rank">
            3: 
        </div>
        <div id="p3_name">            
            <input type="text" placeholder="Spielername" width="150" name="name_p3" id="name_p3" 
            onchange="PlayerNameChanged(name_p3)" onmouseenter="PlayerOnHover('p3')" onmouseleave="PlayerOnNoHover('p3')" />            
        </div>
        <div id="p3_points">
            <input type="number" min="0" placeholder="Punkte" width="30" name="points_p3" id="points_p3" onchange="PlayerPointsChanged(points_p3)"/>
        </div>
    </div>
    <div id="p4" class="block">
        <div id="p4_rank">
            4: 
        </div>
        <div id="p4_name">            
            <input type="text" placeholder="Spielername" width="150" name="name_p4" id="name_p4" 
            onchange="PlayerNameChanged(name_p4)" onmouseenter="PlayerOnHover('p4')" onmouseleave="PlayerOnNoHover('p4')" />            
        </div>
        <div id="p4_points">
            <input type="number" min="0" placeholder="Punkte" width="30" name="points_p4" id="points_p4" onchange="PlayerPointsChanged(points_p4)"/>
        </div>
    </div>
    <div id="p5" class="block">
        <div id="p5_rank">
            5: 
        </div>
        <div id="p5_name">            
            <input type="text" placeholder="Spielername" width="150" name="name_p5" id="name_p5" 
            onchange="PlayerNameChanged(name_p5)" onmouseenter="PlayerOnHover('p5')" onmouseleave="PlayerOnNoHover('p5')" />            
        </div>
        <div id="p5_points">
            <input type="number" min="0" placeholder="Punkte" width="30" name="points_p5" id="points_p5" onchange="PlayerPointsChanged(points_p5)"/>
        </div>
    </div>
    <div id="p6" class="block">
        <div id="p6_rank">
            6: 
        </div>
        <div id="p6_name">            
            <input type="text" placeholder="Spielername" width="150" name="name_p6" id="name_p6" 
            onchange="PlayerNameChanged(name_p6)" onmouseenter="PlayerOnHover('p6')" onmouseleave="PlayerOnNoHover('p6')" />            
        </div>
        <div id="p6_points">
            <input type="number" min="0" placeholder="Punkte" width="30" name="points_p6" id="points_p6" onchange="PlayerPointsChanged(points_p6)"/>
        </div>
    </div>
    <div id="p7" class="block">
        <div id="p7_rank">
            7: 
        </div>
        <div id="p7_name">            
            <input type="text" placeholder="Spielername" width="150" name="name_p7" id="name_p7" 
            onchange="PlayerNameChanged(name_p7)" onmouseenter="PlayerOnHover('p7')" onmouseleave="PlayerOnNoHover('p7')" />            
        </div>
        <div id="p7_points">
            <input type="number" min="0" placeholder="Punkte" width="30" name="points_p7" id="points_p7" onchange="PlayerPointsChanged(points_p7)"/>
        </div>
    </div>
    <div id="p8" class="block">
        <div id="p8_rank">
            8: 
        </div>
        <div id="p8_name">            
            <input type="text" placeholder="Spielername" width="150" name="name_p8" id="name_p8" 
            onchange="PlayerNameChanged(name_p8)" onmouseenter="PlayerOnHover('p8')" onmouseleave="PlayerOnNoHover('p8')" />            
        </div>
        <div id="p8_points">
            <input type="number" min="0" placeholder="Punkte" width="30" name="points_p8" id="points_p8" onchange="PlayerPointsChanged(points_p8)"/>
        </div>
    </div>
</div>

<p>
    <a class="smalllink" href="https://github.com/derco0n/PnPlightsWebControl">Sourcecode</a>
</p>
<script>
    //Javascript code below everything else, as the objects we might use here need to be declared before. 
    var player_uis = [];
    player_uis.push({id: "p1", rank: "p1_rank", name: "p1_name", textbox_name: "name_p1", textbox_points: "points_p1"});
    player_uis.push({id: "p2", rank: "p2_rank", name: "p2_name", textbox_name: "name_p2", textbox_points: "points_p2"});
    player_uis.push({id: "p3", rank: "p3_rank", name: "p3_name", textbox_name: "name_p3", textbox_points: "points_p3"});
    player_uis.push({id: "p4", rank: "p4_rank", name: "p4_name", textbox_name: "name_p4", textbox_points: "points_p4"});
    player_uis.push({id: "p5", rank: "p5_rank", name: "p5_name", textbox_name: "name_p5", textbox_points: "points_p5"});
    player_uis.push({id: "p6", rank: "p6_rank", name: "p6_name", textbox_name: "name_p6", textbox_points: "points_p6"});
    player_uis.push({id: "p7", rank: "p7_rank", name: "p7_name", textbox_name: "name_p7", textbox_points: "points_p7"});
    player_uis.push({id: "p8", rank: "p8_rank", name: "p8_name", textbox_name: "name_p8", textbox_points: "points_p8"});  
    

    // Start: Functions
    function PlayerOnHover(id){ 
        //alert("Hovered "+ id);
        enlightenPlayer(id); //Test
    }

    function PlayerOnNoHover(id){ 
        //alert("Hovered "+ id);
        darkenPlayer(id);  //Test       
    }

    function PlayerNameChanged(id){        
        var p = document.getElementById(id.id);        
        // Get the Player of the current Text-Box
        var Player = getPlayerIDByTextBox(id.id);        
        savePlayername(Player, p.value);  // Save the value in backend
    }

    function PlayerPointsChanged(id){        
        var p = document.getElementById(id.id);        
        // Get the Player of the current Text-Box
        var Player = getPlayerPointsByTextBox(id.id);
        /*
        Todo: Store the value of players point along with the player id in a dictionary,
        Highlight the most valuable player and set its light to on
        */
    }

    function getPlayerIDByTextBox(boxname)
    { // Will get the Player's ID by a given Textbox        
        var myreturn = "Not found!";

        for (let i=0; i<player_uis.length; i++)
        {               
            if (boxname == player_uis[i].textbox_name)
            {  
                myreturn = player_uis[i].id;             
                break;
            }        
        }        
        // alert("! " + myreturn); //DEBUG
        return myreturn;
    }

    function getPlayerPointsByTextBox(boxname)
    { // Will get the Player's points by a given Textbox        
        var myreturn = "Not found!";

        for (let i=0; i<player_uis.length; i++)
        {  
            if (boxname == player_uis[i].textbox_points)
            {  
                myreturn = player_uis[i].id;             
                break;
            }        
        }        
        // alert("! " + myreturn); //DEBUG
        return myreturn;
    }


    function makeGetRequest(encodedURI){
        //Will make a GET-Request to the backend
        fetch(encodedURI)
        .then(response => {
            if (!response.ok) {
            throw new Error('Fehler bei der Kommunikation mit dem Backend!'); //This should not happen
            }
        });
    }

    function highlightPlayername(x) {
        x.style.background="red";
    }

    function savePlayername(id, name){
        //Will set the playername on backend-side
        var uri = encodeURI("http://127.0.0.1:8080/engine?job=setplayer&id="+id+"&name="+name);  //Todo: Need to figure out why this does ten requests at once...
        makeGetRequest(uri);        
    }

    function enlightenPlayer(id){
        //Will tell the backend to turn on player's-light
        var uri = encodeURI("http://127.0.0.1:8080/engine?job=enlightplayer&id="+id+"&onoff=light");  //Todo: Need to figure out why this does ten requests at once...
        //alert(uri);
        makeGetRequest(uri);
    }

    function darkenPlayer(id){
        //Will tell the backend to turn on player's-light
        var uri = encodeURI("http://127.0.0.1:8080/engine?job=enlightplayer&id="+id+"&onoff=darkness");  //Todo: Need to figure out why this does ten requests at once...
        makeGetRequest(uri);
    }

    // End: Functions

</script>
</body>
</html>
